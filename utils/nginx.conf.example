# Nginx Configuration Example
# For standalone-comments system
# Add this to your nginx server block

location /comments/ {
    # Block database directory
    location ~ ^/comments/db/ {
        deny all;
        return 403;
    }

    # Block utils directory
    location ~ ^/comments/utils/ {
        deny all;
        return 403;
    }

    # Block backups directory
    location ~ ^/comments/backups/ {
        deny all;
        return 403;
    }

    # Block sensitive file types
    location ~ \.(db|db-shm|db-wal|sql|log|sh|bak|backup)$ {
        deny all;
        return 403;
    }

    # Block documentation files
    location ~ \.md$ {
        deny all;
        return 403;
    }

    # Process PHP files
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;  # Adjust to your PHP-FPM socket
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;

        # CORS headers for API
        add_header Access-Control-Allow-Origin "https://yourdomain.com" always;
        add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" always;
        add_header Access-Control-Allow-Headers "Content-Type, Authorization" always;
        add_header Access-Control-Allow-Credentials "true" always;

        # Security headers
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-Frame-Options "DENY" always;
        add_header X-XSS-Protection "1; mode=block" always;

        # Handle OPTIONS requests
        if ($request_method = OPTIONS) {
            return 204;
        }
    }

    # Serve static files (HTML, CSS, JS)
    location ~ \.(html|css|js)$ {
        # Allow access
    }
}

# Alternative: Single location block approach
# location /comments {
#     # Block patterns
#     location ~* ^/comments/(db|utils|backups)/ { deny all; return 403; }
#     location ~* \.(db|db-shm|db-wal|sql|sh|log|bak|backup|md)$ { deny all; return 403; }
#
#     # Process PHP
#     location ~ \.php$ {
#         fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
#         include fastcgi_params;
#         fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#     }
# }
